<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perfil Personalizable</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;700&display=swap" rel="stylesheet">
<style>
body {font-family:'Nunito',sans-serif;background:#ffe9f0;margin:0;padding:2rem;color:#333;}
.container{max-width:700px;margin:auto;}
.profile{text-align:center;margin-bottom:2rem;background:#fff;padding:1.5rem;border-radius:1.5rem;box-shadow:0 4px 10px rgba(214,93,132,0.3);}
.avatar{width:120px;height:120px;border-radius:50%;object-fit:cover;border:4px solid #d65d84;}
.edit-btn{margin-top:1rem;padding:0.6rem 1.2rem;border:none;background:#d65d84;color:white;border-radius:0.7rem;cursor:pointer;font-weight:bold;}
.edit-btn:hover{background:#c04a73;}
.post{background:#fff;border-radius:1rem;padding:1rem;margin-bottom:1.5rem;box-shadow:0 3px 8px rgba(214,93,132,0.2);}
.comment{display:flex;align-items:flex-start;gap:0.7rem;margin-top:1rem;}
.comment-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid #d65d84;}
.comment-content{background:#ffe0eb;border-radius:0.8rem;padding:0.6rem 1rem;flex:1;position:relative;}
.comment-header{font-weight:bold;font-size:0.9rem;color:#d65d84;}
.comment-header span{font-size:0.8rem;color:#555;margin-left:0.5rem;font-weight:normal;}
.comment-text{margin-top:0.3rem;font-size:0.9rem;color:#333;}
.comment-media{margin-top:0.5rem;max-width:100%;border-radius:0.5rem;}
.comment-actions{margin-top:0.4rem;font-size:0.8rem;display:flex;gap:0.6rem;}
.comment-actions button{border:none;background:none;cursor:pointer;color:#c04a73;font-weight:bold;}
.comment-actions button:hover{text-decoration:underline;}
.pinned{border:2px solid #d65d84;background:#fff1f6;}
.comment-time{font-size:0.7rem;color:#555;margin-top:0.3rem;}
.comment-input{width:100%;margin-top:1rem;padding:0.6rem;border:1px solid #ccc;border-radius:0.7rem;font-family:inherit;}
.file-input{margin-top:0.7rem;text-align:center;}
.file-input input{display:none;}
.file-input label{background:#d65d84;color:white;padding:0.4rem 1rem;border-radius:0.5rem;cursor:pointer;font-size:0.9rem;}
.file-input label:hover{background:#c04a73;}
</style>
</head>
<body>
<div class="container">
  <div class="profile">
    <img id="user-photo" class="avatar" src="https://via.placeholder.com/120">
    <h2 id="user-name">Tu Nombre</h2>
    <p id="user-pronouns">Tus pronombres</p>
    <button class="edit-btn" onclick="editProfile()">Editar Perfil</button>
    <div class="file-input">
      <input type="file" id="photo-input" accept="image/*">
      <label for="photo-input">üì∑ Cambiar foto</label>
    </div>
  </div>

  <div class="post">
    <p>üå∏ Bienvenido a tu muro personalizado, deja un comentario con imagen o video.</p>
    <div id="comments-container"></div>
  </div>
</div>

<script>
// --- LOGIN SIMULADO ---
let userEmail = localStorage.getItem("userEmail");
if (!userEmail){
  userEmail = prompt("Ingresa tu correo para continuar:");
  if (userEmail){
    let registered = confirm("¬øYa est√°s registrada?");
    if(!registered) alert("Perfecto, te registramos de forma local (simulado).");
    localStorage.setItem("userEmail", userEmail);
  }
}

// PERFIL y comentarios
let profileKey = "profile_" + userEmail;
let profile = JSON.parse(localStorage.getItem(profileKey)) || {name:"Tu Nombre",pronouns:"Tus pronombres",photo:"https://via.placeholder.com/120"};
let commentsKey = "comments_" + userEmail;
let comments = JSON.parse(localStorage.getItem(commentsKey)) || [];

function loadProfile(){
  document.getElementById("user-name").textContent = profile.name;
  document.getElementById("user-pronouns").textContent = profile.pronouns;
  document.getElementById("user-photo").src = profile.photo;
}

function editProfile(){
  const name = prompt("Tu nombre:",profile.name);
  const pronouns = prompt("Tus pronombres:",profile.pronouns);
  if(name) profile.name = name;
  if(pronouns) profile.pronouns = pronouns;
  localStorage.setItem(profileKey,JSON.stringify(profile));
  loadProfile();
}

document.getElementById("photo-input").addEventListener("change", function(){
  const file = this.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      profile.photo = e.target.result;
      localStorage.setItem(profileKey,JSON.stringify(profile));
      loadProfile();
    };
    reader.readAsDataURL(file);
  }
});

// UTIL: calcular tiempo transcurrido
function timeAgo(date){
  const now = new Date();
  const seconds = Math.floor((now - date)/1000);
  if(seconds<60) return seconds+" seg atr√°s";
  const minutes = Math.floor(seconds/60);
  if(minutes<60) return minutes+" min atr√°s";
  const hours = Math.floor(minutes/60);
  if(hours<24) return hours+" hrs atr√°s";
  const days = Math.floor(hours/24);
  return days+" d√≠as atr√°s";
}

function renderComments(){
  const container = document.getElementById("comments-container");
  container.innerHTML = "";

  let pinned = comments.filter(c=>c.pinned);
  let normal = comments.filter(c=>!c.pinned);

  pinned.forEach(c=>renderComment(container,c,true));
  normal.forEach(c=>renderComment(container,c,false));

  const input = document.createElement("input");
  input.className = "comment-input";
  input.placeholder = "Escribe un comentario...";
  input.addEventListener("keydown", e=>{
    if(e.key==="Enter" && input.value.trim()){
      let mediaFile = input.dataset.media || "";
      comments.push({text:input.value.trim(),name:profile.name,pronouns:profile.pronouns,photo:profile.photo,pinned:false,time:new Date().toISOString(),media:mediaFile});
      localStorage.setItem(commentsKey,JSON.stringify(comments));
      input.value=""; input.dataset.media="";
      renderComments();
    }
  });
  container.appendChild(input);

  // Bot√≥n subir archivo (imagen/video)
  const fileDiv = document.createElement("div");
  fileDiv.className = "file-input";
  fileDiv.innerHTML = `<input type="file" id="comment-media" accept="image/*,video/*">
  <label for="comment-media">üìé Agregar imagen/video</label>`;
  container.appendChild(fileDiv);

  document.getElementById("comment-media").addEventListener("change", function(){
    const file = this.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = e=> {input.dataset.media = e.target.result;}
      reader.readAsDataURL(file);
    }
  });
}

function renderComment(container,c,isPinned){
  const div = document.createElement("div");
  div.className = "comment"+(isPinned?" pinned":"");
  let mediaHtml = "";
  if(c.media){
    if(c.media.startsWith("data:video")) mediaHtml = `<video class="comment-media" controls src="${c.media}"></video>`;
    else mediaHtml = `<img class="comment-media" src="${c.media}">`;
  }
  div.innerHTML = `
    <img src="${c.photo}" class="comment-avatar">
    <div class="comment-content">
      <div class="comment-header">${c.name} <span>${c.pronouns}</span></div>
      <div class="comment-text">${c.text}</div>
      ${mediaHtml}
      <div class="comment-time">${timeAgo(new Date(c.time))}</div>
      <div class="comment-actions">
        <button onclick="deleteComment('${c.time}')">üóë Borrar</button>
        <button onclick="togglePin('${c.time}')">${c.pinned?"‚ùå Quitar fijo":"üìå Destacar"}</button>
      </div>
    </div>
  `;
  container.appendChild(div);
}

function deleteComment(time){
  comments = comments.filter(c=>c.time!==time);
  localStorage.setItem(commentsKey,JSON.stringify(comments));
  renderComments();
}

function togglePin(time){
  let pinned = comments.filter(c=>c.pinned);
  comments = comments.map(c=>{
    if(c.time===time){
      if(c.pinned) c.pinned=false;
      else if(pinned.length<4) c.pinned=true;
      else alert("M√°ximo 4 comentarios destacados.");
    }
    return c;
  });
  localStorage.setItem(commentsKey,JSON.stringify(comments));
  renderComments();
}

loadProfile();
renderComments();
</script>
</body>
</html>
